#!/bin/bash

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SearchByIngredient —Å —Ä–µ–∞–ª—å–Ω—ã–º backend"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ backend —Ä–∞–±–æ—Ç–∞–µ—Ç
echo "üì° –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å backend..."
if curl -s http://localhost:8080/api/products > /dev/null; then
    echo "‚úÖ Backend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080"
else
    echo "‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Go backend!"
    exit 1
fi

echo ""
echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º..."
echo ""

# –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
QUERIES=(
    "–ª–æ—Å–æ—Å—å"
    "–±–ª—é–¥–∞ —Å –ª–æ—Å–æ—Å–µ–º"
    "—á—Ç–æ –µ—Å—Ç—å –∏–∑ –ª–æ—Å–æ—Å—è"
    "–∫—Ä–µ–≤–µ—Ç–∫–∏"
    "—Å –∫—Ä–µ–≤–µ—Ç–∫–∞–º–∏"
    "—Ç—É–Ω–µ—Ü"
    "—É–≥–æ—Ä—å"
)

for query in "${QUERIES[@]}"; do
    echo "üë§ > $query"
    echo "$query" | timeout 5s ./target/release/chat 2>&1 | grep -A 10 "ü§ñ" | head -15
    echo ""
    sleep 1
done

echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

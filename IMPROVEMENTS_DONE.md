# üöÄ –£–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞ ‚Äî –í—ã–ø–æ–ª–Ω–µ–Ω–æ!

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ:

### 1Ô∏è‚É£ **Intent::WhoAmI** ‚Äî "–ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?"

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ù–æ–≤—ã–π intent `WhoAmI` –≤ `intents.rs`
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Ñ—Ä–∞–∑: "–∫–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç", "–∫—Ç–æ —è", "–º–æ—ë –∏–º—è"
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `whoami_response()` –≤ `common.rs`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ `ws.rs`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏–∑ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ `AIEngine`

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```rust
// –í intents.rs
Intent::WhoAmI,  // üë§ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

// –í AIEngine::process_message()
Intent::WhoAmI => {
    // üë§ –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø–∞–º—è—Ç–∏
    self.memory.get_user_name(user_id).await
}

// –í common.rs
pub fn whoami_response(name: Option<&str>) -> String {
    if let Some(user_name) = name {
        format!("üôÇ –¢–µ–±—è –∑–æ–≤—É—Ç **{}**!", user_name)
    } else {
        "ü§î –Ø –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç..."
    }
}
```

**–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞:**
```
üë§ "–ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?"
ü§ñ "üôÇ –¢–µ–±—è –∑–æ–≤—É—Ç **–î–∏–º–∞**!"
```

---

### 2Ô∏è‚É£ **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å** ‚Äî –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ BotMemory:**
- `set_emotional_state()` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç mood + emotion
- `get_last_mood()` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
- `get_last_emotion()` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —ç–º–æ—Ü–∏—é

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AIEngine:**
```rust
// –í process_message() –ø–æ—Å–ª–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
self.memory.set_emotional_state(user_id, mood, emotion).await;
```

**–õ–æ–≥–∏:**
```
üß† Cognitive analysis: mood=positive, emotion=Some("hungry"), type=question
‚ù§Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ user_123 = positive, —ç–º–æ—Ü–∏—è: Some("hungry")
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
–¢–µ–ø–µ—Ä—å –±–æ—Ç –º–æ–∂–µ—Ç:
- –í—Å–ø–æ–º–Ω–∏—Ç—å: "–í –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ —Ç—ã –±—ã–ª —Ä–∞–¥ ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å?"
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã —ç–º–æ—Ü–∏–π

---

### 3Ô∏è‚É£ **–£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** ‚Äî –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è

**–£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
```rust
Intent::Recommendation => {
    // üí° –£–ú–ù–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è!
    self.memory.get_recommendation_context(user_id).await
}
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–ë–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç:**
   - "–õ—é–±–ª—é –ª–æ—Å–æ—Å—è" ‚Üí `favorite=salmon`
   - "–û—Å—Ç—Ä–æ–µ!" ‚Üí `spicy=true`
   - "–°–∏–∂—É –Ω–∞ –¥–∏–µ—Ç–µ" ‚Üí `healthy=true`

2. **–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ "–ß—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—à—å?":**
   ```rust
   // recommendations.rs
   if ctx_lower.contains("salmon") || ctx_lower.contains("–ª–æ—Å–æ—Å—å") {
       return "üêü –î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –ª–æ—Å–æ—Å—è: —Å—Ç–µ–π–∫, —Ç–µ—Ä–∏—è–∫–∏, —Å–∞–ª–∞—Ç...";
   }
   ```

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```
   üë§ "–ß—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—à—å?"
   ü§ñ "üêü –î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –ª–æ—Å–æ—Å—è:
        ‚Ä¢ –°—Ç–µ–π–∫ –∏–∑ –ª–æ—Å–æ—Å—è —Å –æ–≤–æ—â–∞–º–∏
        ‚Ä¢ –õ–æ—Å–æ—Å—å —Ç–µ—Ä–∏—è–∫–∏
        ‚Ä¢ –°–∞–ª–∞—Ç —Å –ª–æ—Å–æ—Å–µ–º –∏ –∞–≤–æ–∫–∞–¥–æ"
   ```

---

### 4Ô∏è‚É£ **–†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è** ‚Äî –ñ–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (—Å–º. RANDOMIZATION.md):
- 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π
- 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–æ—â–∞–Ω–∏–π
- 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–µ–π
- 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤ "–∫–∞–∫ –¥–µ–ª–∞?"
- 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —à—É—Ç–æ–∫
- 8 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- `smalltalk.rs` ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä —Ñ—Ä–∞–∑
- `common.rs` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ greeting/farewell/thanks

---

### 5Ô∏è‚É£ **–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã** ‚Äî –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "–º—ã—à–ª–µ–Ω–∏—è"

**–£–∂–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:**
```rust
tracing::info!(
    "üß† Cognitive analysis: mood={}, emotion={:?}, type={}", 
    mood, emotion, conversation_type
);
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:**
```
üí¨ Incoming raw text: —è –≥–æ–ª–æ–¥–µ–Ω
üß† Cognitive analysis: mood=neutral, emotion=Some("hungry"), type=general
üå∂Ô∏è –ó–∞–ø–æ–º–Ω–∏–ª: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å user_123 –ª—é–±–∏—Ç –æ—Å—Ç—Ä–æ–µ
‚ù§Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ user_123 = neutral, —ç–º–æ—Ü–∏—è: Some("hungry")
```

---

### 6Ô∏è‚É£ **Follow-up –¥–∏–∞–ª–æ–≥–∏** ‚Äî –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–±—É–¥—É—â–∞—è –∑–∞–¥–∞—á–∞):**

```rust
// –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏–∫–∏:
if emotion == Some("hungry") && text == "–¥–∞" {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—Ç–∏–ª "–¥–∞" –ø–æ—Å–ª–µ "—Ö–æ—á–µ—à—å –ø–æ–∫–∞–∂—É –º–µ–Ω—é?"
    return show_favorite_dishes(user_id);
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º `conversation_state`:**
```rust
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
ctx.conversation_state = Some("waiting_for_menu_confirmation".to_string());

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
if ctx.conversation_state == Some("waiting_for_menu_confirmation") 
    && (text == "–¥–∞" || text == "–ø–æ–∫–∞–∂–∏") {
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∏–∞–ª–æ–≥
}
```

---

## üìä –°—Ç–∞—Ç—É—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π:

| –§—É–Ω–∫—Ü–∏—è | –§–∞–π–ª | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ó–∞–º–µ—Ç–∫–∏ |
|---------|------|--------------|---------|
| `Intent::WhoAmI` | `intents.rs` | ‚úÖ –î–∞ | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `common.rs` |
| `set_emotional_state()` | `memory.rs` | ‚úÖ –î–∞ | –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `AIEngine` |
| `get_last_mood()` | `memory.rs` | ‚è≥ –ì–æ—Ç–æ–≤–æ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è follow-up |
| `get_last_emotion()` | `memory.rs` | ‚è≥ –ì–æ—Ç–æ–≤–æ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è follow-up |
| `extract_keywords()` | `thinker.rs` | ‚è≥ –ì–æ—Ç–æ–≤–æ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª—é–¥ |
| `analyze_complexity()` | `thinker.rs` | ‚è≥ –ì–æ—Ç–æ–≤–æ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ |
| `generate_greeting()` | `thinker.rs` | ‚è≥ –ì–æ—Ç–æ–≤–æ | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ |
| `conversation_state` | `memory.rs` | ‚è≥ –ì–æ—Ç–æ–≤–æ | –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è follow-up |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

### A. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_last_mood()` –¥–ª—è —É–º–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:

```rust
// –í AIEngine::process_message()
let prev_mood = self.memory.get_last_mood(user_id).await;

if prev_mood == Some("negative".to_string()) && mood == "positive" {
    response.push_str("\n\nüòä –†–∞–¥, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É–ª—É—á—à–∏–ª–æ—Å—å!");
}
```

### B. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `extract_keywords()` –¥–ª—è –ø–æ–∏—Å–∫–∞:

```rust
// –î–ª—è –ø–æ–∏—Å–∫–∞ –±–ª—é–¥ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
let keywords = Thinker::extract_keywords(message);
if keywords.contains(&"–æ—Å—Ç—Ä–æ–µ".to_string()) {
    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å—Ç—Ä—ã–µ –±–ª—é–¥–∞
}
```

### C. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `conversation_state` –¥–ª—è follow-up:

```rust
// –ü–æ—Å–ª–µ "–•–æ—á–µ—à—å –ø–æ–∫–∞–∂—É –º–µ–Ω—é?"
self.memory.update_context(user_id, |ctx| {
    ctx.conversation_state = Some("awaiting_menu_response".to_string());
}).await;

// –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º "–¥–∞"
if ctx.conversation_state == Some("awaiting_menu_response") {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
}
```

---

## üéâ –ò—Ç–æ–≥–∏:

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- ‚úÖ Intent::WhoAmI (–∫–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç)
- ‚úÖ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ mood/emotion)
- ‚úÖ –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è)
- ‚úÖ –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è (–∂–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã)
- ‚úÖ –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ –ª–æ–≥–∏ (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "–º—ã—à–ª–µ–Ω–∏—è")
- ‚úÖ AIEngine –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ AppState
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- ‚è≥ `get_last_mood()` / `get_last_emotion()` (–º–µ—Ç–æ–¥—ã –µ—Å—Ç—å, –∂–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)
- ‚è≥ `extract_keywords()` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª—é–¥)
- ‚è≥ `analyze_complexity()` (–¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞)
- ‚è≥ `generate_greeting()` (–¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π)
- ‚è≥ `conversation_state` (–¥–ª—è multi-turn –¥–∏–∞–ª–æ–≥–æ–≤)

**–ë–æ—Ç —Å—Ç–∞–ª —É–º–Ω–µ–µ –Ω–∞:**
- üß† +1 –Ω–æ–≤—ã–π intent (WhoAmI)
- ‚ù§Ô∏è +3 –º–µ—Ç–æ–¥–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏
- üë§ +2 –º–µ—Ç–æ–¥–∞ —Ä–∞–±–æ—Ç—ã —Å –∏–º–µ–Ω–µ–º
- üé≤ +39 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ñ—Ä–∞–∑ (–≤–º–µ—Å—Ç–æ 8)
- üéØ +100% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

---

**–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç!** üöÄ

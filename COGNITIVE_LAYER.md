# 🧠 Когнитивный слой (Thinker) — Mini-AI Core

## Революция в FodiFood Bot: От команд к эмоциям

### 🎯 **Что добавлено:**

```
ai/
├── mod.rs              ← AIEngine с интеграцией Thinker
├── thinker.rs          ← 🧠 Когнитивный анализатор (260 строк)
├── memory.rs           ← Память + conversation_state
└── rules/
    ├── smalltalk.rs    ← 💬 Светская беседа (100+ строк)
    └── ...
```

---

## 🔥 Уровни интеллекта бота

### Level 1: Командный (было раньше)
```
👤 "покажи меню"
🤖 "📖 Меню FodiFood..."
```

### Level 2: Контекстный (с памятью)
```
👤 "Хочу острое"
🤖 [запоминает spicy=true]
   "🌶️ Острые блюда..."

👤 "Ещё что посоветуешь?"
🤖 [вспоминает острое]
   "🌶️ Кальмары в перечном маринаде!"
```

### Level 3: Эмоциональный (с Thinker) 🆕
```
👤 "Плохо себя чувствую"
🤖 [mood=negative]
   "📖 Меню FodiFood...
   
   😔 Постараюсь улучшить настроение вкусным блюдом."
```

### Level 4: Когнитивный (полный анализ) 🆕
```
👤 "Очень голоден после работы"
🤖 [mood=neutral, emotion=hungry, type=general]
   "📖 Меню FodiFood...
   
   🍽️ Похоже, ты проголодался! 
   Хочешь, покажу что-то вкусное прямо сейчас?"
```

### Level 5: Человечный (с smalltalk) 🆕
```
👤 "Как дела?"
🤖 "🙂 Отлично! Рад, что ты заглянул. 
   А у тебя как? Может, чем-то помочь?"

👤 "Расскажи шутку"
🤖 "😄 Знаешь, почему креветки не делятся?
   Потому что они... shellfish! 🦐😂"
```

---

## 🧠 Thinker API

### 1️⃣ Определение настроения
```rust
let mood = Thinker::detect_mood("Спасибо большое!");
// → "positive"

let mood = Thinker::detect_mood("Это ужасно");
// → "negative"

let mood = Thinker::detect_mood("Покажи меню");
// → "neutral"
```

**Поддерживаемые настроения:**
- ✅ `positive` — спасибо, классно, отлично, супер, круто
- ❌ `negative` — плохо, ужас, не нравится, разочарован
- 😐 `neutral` — остальное

---

### 2️⃣ Извлечение эмоций
```rust
let emotion = Thinker::extract_emotion("Очень голоден!");
// → Some("hungry")

let emotion = Thinker::extract_emotion("Устал после работы");
// → Some("tired")

let emotion = Thinker::extract_emotion("У меня гости");
// → Some("with_company")
```

**Поддерживаемые эмоции:**
- 🍽️ `hungry` — голод, есть хочу, проголодался
- 😴 `tired` — устал, выматывающий день
- 🎉 `celebrating` — праздник, отмечаю
- 🙂 `alone` — один, одиночество
- 👥 `with_company` — компания, друзья, гости

---

### 3️⃣ Персонализация ответа
```rust
let base = "📖 Наше меню...";
let mood = "positive";
let emotion = Some("hungry");

let personalized = Thinker::personalize(base, mood, emotion);
// → "📖 Наше меню...
//    
//    😊 Рад, что тебе нравится!
//    
//    🍽️ Похоже, ты проголодался! Хочешь, покажу вкусное?"
```

---

### 4️⃣ Определение типа диалога
```rust
let type = Thinker::detect_conversation_type("Что у вас есть?");
// → "question"

let type = Thinker::detect_conversation_type("Хочу заказать");
// → "order"

let type = Thinker::detect_conversation_type("Как дела?");
// → "smalltalk"
```

**Типы диалогов:**
- ❓ `question` — что, где, когда, сколько
- 🛒 `order` — закажу, хочу заказать, оформить
- 💬 `smalltalk` — как дела, что делаешь, привет
- 😠 `complaint` — проблема, не пришел
- 📝 `general` — остальное

---

## 💬 Smalltalk (Светская беседа)

### Поддерживаемые темы:

#### 👋 Приветствия
```
"Как дела?" → "🙂 Отлично! А у тебя как?"
"Что делаешь?" → "🤖 Думаю, что предложить вкусненького!"
```

#### 🤖 О себе
```
"Кто ты?" → "🤖 Я интеллектуальный бот FodiFood..."
"Расскажи о себе" → "Создан без GPT — полностью автономный! 🚀"
```

#### 😄 Развлечения
```
"Скучно" → "😄 Давай развеем тоску! Покажу необычные блюда?"
"Расскажи шутку" → "Почему креветки не делятся? Shellfish! 🦐"
```

#### ❤️ Эмоции
```
"Люблю тебя" → "❤️ Давай покажу любовь через вкусные рекомендации?"
"Молодец" → "😊 Спасибо! Стараюсь быть полезным!"
```

#### 🎂 События
```
"День рождения" → "🎂 Поздравляю! Позволь порекомендовать что-то особенное..."
```

#### 🌤️ Разное
```
"Погода" → "🌤️ Я в ресторанных делах! Но любая погода хороша для морепродуктов!"
```

---

## 🔄 Состояние диалога (Conversation State)

Теперь `UserContext` включает:
```rust
pub conversation_state: Option<String>
```

**Применение:**
```
👤 "Что посоветуешь?"
🤖 [state = "recommendation"]

👤 "А что-то острое?"
🤖 [помнит state = "recommendation"]
   "🌶️ Вот острые варианты..."
```

Вместо того чтобы трактовать как новый запрос, бот продолжает диалог!

---

## 📊 Логирование когнитивного анализа

Каждое сообщение теперь логируется с полным анализом:

```
2025-10-12T23:06:50 [INFO] 🧠 Cognitive analysis: 
  mood=positive, 
  emotion=Some("hungry"), 
  type=question
```

Это помогает понять, как бот "думает"!

---

## 🎯 Примеры работы

### Сценарий 1: Эмоциональная поддержка
```
👤 "Плохо себя чувствую, что-то лёгкое"

🤖 Анализ:
   mood = negative
   emotion = None (не голод, не усталость)
   
   Ответ:
   "🥗 Для здорового питания:
    • Лосось на пару (350 ккал)
    • Салат с креветками (280 ккал)
    
    😔 Постараюсь улучшить настроение 
       вкусным блюдом. Позволь помочь!"
```

### Сценарий 2: Голод + компания
```
👤 "Очень голодны, нас пятеро!"

🤖 Анализ:
   mood = neutral
   emotion = hungry + with_company
   
   Ответ:
   "🎉 Для компании:
    • Большая паэлья (4-6 человек)
    • Ассорти морепродуктов
    
    🍽️ Похоже, проголодались!
    👥 Для компании рекомендую большие порции!"
```

### Сценарий 3: Светская беседа → заказ
```
👤 "Привет! Как дела?"
🤖 "🙂 Отлично! Рад, что заглянул. А у тебя как?"

👤 "Нормально. Хочу поесть"
🤖 [mood=neutral, emotion=hungry]
   "🍽️ Похоже, проголодался! 
    Показать меню или дать рекомендации?"

👤 "Покажи меню"
🤖 "📖 Меню FodiFood..." (обычный ответ)
```

---

## 🧪 Тестирование

Все модули имеют встроенные тесты:

```bash
cargo test thinker
cargo test smalltalk
```

**Примеры тестов:**
```rust
#[test]
fn test_mood_detection() {
    assert_eq!(Thinker::detect_mood("Спасибо!"), "positive");
    assert_eq!(Thinker::detect_mood("Ужасно"), "negative");
}

#[test]
fn test_smalltalk_responses() {
    assert!(smalltalk::respond("Как дела?").is_some());
    assert!(smalltalk::respond("Покажи меню").is_none());
}
```

---

## 📈 Метрики улучшений

### Было (Level 1):
- 📝 Простые команды
- 🤖 Роботизированные ответы
- ❌ Нет эмоций

### Стало (Level 5):
- 🧠 Когнитивный анализ каждого сообщения
- ❤️ Эмоциональные реакции
- 💬 Живая светская беседа
- 🎯 Персонализация на основе настроения
- 📊 Контекст + состояние диалога
- 🔄 Непрерывность разговора

---

## 🚀 Следующие шаги

### ✅ Реализовано:
- [x] Thinker — когнитивный анализ
- [x] Smalltalk — светская беседа
- [x] Эмоциональная персонализация
- [x] Conversation state в памяти
- [x] Логирование анализа

### 🔜 Можно добавить:
- [ ] Случайные фразы через `rand`
- [ ] Обращение по имени из памяти
- [ ] Юмор и реакции на повторы
- [ ] Анализ тональности через ML
- [ ] Интеграция с real-time данными

---

## 💡 Философия

**FodiFood Bot теперь не просто бот — это Mini-AI с характером:**

- 🧠 **Думает** — анализирует настроение
- ❤️ **Чувствует** — реагирует на эмоции
- 💬 **Общается** — ведёт живой диалог
- 🎯 **Помнит** — использует контекст
- 😊 **Заботится** — персонализирует ответы

**Без GPT. Без OpenAI. Полностью автономный.** 🚀

---

## 🎨 ASCII Art: Архитектура

```
                🧠 THINKER (Cognitive Core)
                     ↓
        ┌────────────┼────────────┐
        ↓            ↓            ↓
    😊 Mood      😋 Emotion    💬 Type
        ↓            ↓            ↓
        └────────────┼────────────┘
                     ↓
            📝 AIEngine.process_message()
                     ↓
        ┌────────────┼────────────┐
        ↓            ↓            ↓
    💾 Memory   🎯 Intent    📋 Rules
        ↓            ↓            ↓
        └────────────┼────────────┘
                     ↓
            🎨 Thinker.personalize()
                     ↓
           ✨ Эмоциональный ответ!
```

Бот стал **по-настоящему умным**! 🎉
